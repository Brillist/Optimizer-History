#include "libclp.h"
#include "And.h"
#include "Manager.h"

////////////////////////////////////////////////////////////////////////////////////////////////////

UTL_NS_USE;
LUT_NS_USE;

////////////////////////////////////////////////////////////////////////////////////////////////////

UTL_CLASS_IMPL(clp::And);

////////////////////////////////////////////////////////////////////////////////////////////////////

CLP_NS_BEGIN;

////////////////////////////////////////////////////////////////////////////////////////////////////

And::And(Goal* g0, Goal* g1)
    : Goal(g0->manager())
{
    init();
    _goals.push_back(g0);
    _goals.push_back(g1);
    addRefCont(_goals);
}

////////////////////////////////////////////////////////////////////////////////////////////////////

void
And::copy(const Object& rhs_)
{
    auto& rhs = utl::cast<And>(rhs_);
    super::copy(rhs);
    clear();
    copyVector(_goals, rhs._goals);
    addRefCont(_goals);
}

////////////////////////////////////////////////////////////////////////////////////////////////////

void
And::clear()
{
    removeRefCont(_goals);
}

////////////////////////////////////////////////////////////////////////////////////////////////////

void
And::execute()
{
    auto mgr = manager();
    ASSERTD(!_goals.empty());
    auto it = _goals.end();
    for (--it;; --it)
    {
        auto goal = *it;
        mgr->add(goal);
        if (it == _goals.begin())
        {
            break;
        }
    }
    clear();
}

////////////////////////////////////////////////////////////////////////////////////////////////////

CLP_NS_END;
